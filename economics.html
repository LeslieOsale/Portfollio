<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Regression with Background Video</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      color: white;
      overflow-x: hidden;
    }
    /* Background Video */
    #bgVideo {
      position: fixed;
      top: 0;
      left: 0;
      min-width: 100%;
      min-height: 100%;
      z-index: -1;
      object-fit: cover;
    }
    /* Dark overlay for readability */
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: -1;
    }
    header {
      text-align: center;
      padding: 20px;
      background: rgba(0, 0, 0, 0.8);
    }
    header h1 {
      margin: 0;
      font-size: 2rem;
    }
    main {
      padding: 20px;
      text-align: center;
    }
    .controls {
      margin: 20px auto;
      max-width: 800px;
      text-align: center;
      color: white;
    }
    .controls input {
      margin: 10px;
      width: 300px;
    }
    .metrics {
      margin: 20px auto;
      max-width: 800px;
      text-align: left;
      background: rgba(0, 0, 0, 0.8);
      padding: 15px;
      border-radius: 10px;
    }
    .chart-container {
      width: 100%;
      max-width: 800px;
      margin: auto;
    }
    footer {
      background-color: #111;
      color: white;
      text-align: center;
      padding: 10px 0;
      margin-top: 40px;
    }
  </style>
</head>
<body>

<!-- Background Video -->
<video autoplay muted loop id="bgVideo">
  <source src="https://res.cloudinary.com/dwpr0xrjq/video/upload/v1733732461/bg2_qyldnu.mp4" type="video/mp4">
</video>
<div id="overlay"></div>

<header>
  <h1>Interactive Regression Analysis</h1>
  <p>Adjust coefficients and explore statistical metrics in real-time.</p>
</header>

<main>
  <section class="controls">
    <h3>Adjust Parameters</h3>
    <label for="sizeCoeff">Size Coefficient:</label>
    <input type="range" id="sizeCoeff" min="50" max="300" value="150">
    <span id="sizeCoeffValue">150</span><br>

    <label for="bedroomCoeff">Bedroom Coefficient:</label>
    <input type="range" id="bedroomCoeff" min="5000" max="20000" value="10000">
    <span id="bedroomCoeffValue">10000</span><br>

    <label for="basePrice">Base Price:</label>
    <input type="range" id="basePrice" min="20000" max="100000" value="50000">
    <span id="basePriceValue">50000</span><br>

    <label for="noiseLevel">Noise Level:</label>
    <input type="range" id="noiseLevel" min="0" max="20000" value="5000">
    <span id="noiseLevelValue">5000</span><br>

    <h3>Upload CSV</h3>
    <input type="file" id="csvFile" accept=".csv">
  </section>

  <div id="regressionChart" class="chart-container"></div>

  <section class="metrics">
    <h3>Statistical Metrics</h3>
    <p><strong>RÂ²:</strong> <span id="rSquared">0.00</span></p>
    <p><strong>RMSE:</strong> <span id="rmse">0.00</span></p>
  </section>
</main>

<footer>
  <p>Created by Code Copilot</p>
</footer>

<script>
  let sizes, bedrooms, prices, basePrice = 50000, sizeCoeff = 150, bedroomCoeff = 10000, noiseLevel = 5000;

  function generateSimulatedData() {
    const numPoints = 100;
    sizes = Array.from({ length: numPoints }, () => Math.random() * 500 + 500); // Sizes in sq ft
    bedrooms = Array.from({ length: numPoints }, () => Math.random() * 5 + 1); // Bedrooms
    prices = sizes.map((size, i) =>
      basePrice + sizeCoeff * size + bedroomCoeff * bedrooms[i] + Math.random() * noiseLevel - noiseLevel / 2
    );
  }

  function calculateMetrics(predictedPrices) {
    const meanPrice = prices.reduce((sum, p) => sum + p, 0) / prices.length;
    const ssTotal = prices.reduce((sum, p) => sum + (p - meanPrice) ** 2, 0);
    const ssResidual = prices.reduce((sum, p, i) => sum + (p - predictedPrices[i]) ** 2, 0);
    const rSquared = 1 - ssResidual / ssTotal;
    const rmse = Math.sqrt(ssResidual / prices.length);
    return { rSquared, rmse };
  }

  function updateRegressionPlane() {
    const predictedPrices = sizes.map((size, i) =>
      basePrice + sizeCoeff * size + bedroomCoeff * bedrooms[i]
    );

    const { rSquared, rmse } = calculateMetrics(predictedPrices);
    document.getElementById("rSquared").innerText = rSquared.toFixed(2);
    document.getElementById("rmse").innerText = rmse.toFixed(2);

    const dataPoints = {
      x: sizes,
      y: bedrooms,
      z: prices,
      mode: "markers",
      type: "scatter3d",
      marker: { color: "blue", size: 4 },
      name: "Observed Data"
    };

    const regressionPlane = {
      x: sizes,
      y: bedrooms,
      z: predictedPrices,
      type: "mesh3d",
      opacity: 0.5,
      color: "orange",
      name: "Regression Plane"
    };

    const layout = {
      title: "3D Multiple Linear Regression",
      scene: {
        xaxis: { title: "Size (sq ft)" },
        yaxis: { title: "Bedrooms" },
        zaxis: { title: "House Price ($)" }
      }
    };

    Plotly.newPlot("regressionChart", [dataPoints, regressionPlane], layout);
  }

  function handleCSVUpload(event) {
    const file = event.target.files[0];
    if (file) {
      Papa.parse(file, {
        header: true,
        dynamicTyping: true,
        complete: (results) => {
          sizes = results.data.map(row => row.Size);
          bedrooms = results.data.map(row => row.Bedrooms);
          prices = results.data.map(row => row.Price);
          updateRegressionPlane();
        }
      });
    }
  }

  document.getElementById("sizeCoeff").addEventListener("input", (event) => {
    sizeCoeff = Number(event.target.value);
    document.getElementById("sizeCoeffValue").innerText = sizeCoeff;
    updateRegressionPlane();
  });

  document.getElementById("bedroomCoeff").addEventListener("input", (event) => {
    bedroomCoeff = Number(event.target.value);
    document.getElementById("bedroomCoeffValue").innerText = bedroomCoeff;
    updateRegressionPlane();
  });

  document.getElementById("basePrice").addEventListener("input", (event) => {
    basePrice = Number(event.target.value);
    document.getElementById("basePriceValue").innerText = basePrice;
    updateRegressionPlane();
  });

  document.getElementById("noiseLevel").addEventListener("input", (event) => {
    noiseLevel = Number(event.target.value);
    document.getElementById("noiseLevelValue").innerText = noiseLevel;
    generateSimulatedData();
    updateRegressionPlane();
  });

  document.getElementById("csvFile").addEventListener("change", handleCSVUpload);

  generateSimulatedData();
  updateRegressionPlane();
</script>

</body>
</html>
